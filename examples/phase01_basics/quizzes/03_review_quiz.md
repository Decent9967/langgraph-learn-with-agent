# ç¬¬ä¸€é˜¶æ®µå¤ä¹ æµ‹éªŒ

> å¤ä¹ æ—¶é—´ï¼š2025-02-08
> ç›®çš„ï¼šå·©å›ºç¬¬ä¸€é˜¶æ®µæ ¸å¿ƒçŸ¥è¯†

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

1. **å…ˆè‡ªå·±å›ç­”**ï¼šçœ‹å®Œé—®é¢˜ï¼Œå…ˆè‡ªå·±æƒ³ç­”æ¡ˆ
2. **å†æŸ¥çœ‹ç­”æ¡ˆ**ï¼šç‚¹å‡»ğŸ‘†æŸ¥çœ‹ç­”æ¡ˆ
3. **æ ‡è®°æŒæ¡æƒ…å†µ**ï¼š
   - âœ… å®Œå…¨æŒæ¡
   - âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
   - âŒ å®Œå…¨å¿˜è®°

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¦‚å¿µï¼ˆ5é¢˜ï¼‰

### é—®é¢˜1ï¼šState æ˜¯ä»€ä¹ˆï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š











---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

State å°±åƒä¼ é€å¸¦ä¸Šçš„åŒ…è£¹ ğŸ“¦

- **ä½œç”¨**ï¼šå­˜å‚¨å¯¹è¯å†å²ï¼ˆæ¶ˆæ¯åˆ—è¡¨ï¼‰
- **ä¼ é€’**ï¼šåœ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼ é€’
- **æ›´æ–°**ï¼šæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿®æ”¹å®ƒ

**ä»£ç ç¤ºä¾‹**ï¼š
```python
class CalculatorState(MessagesState):
    pass  # ç»§æ‰¿ MessagesStateï¼Œè‡ªåŠ¨æœ‰ messages å­—æ®µ
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜2ï¼šNodes å’Œ Edges çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š











---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

**Nodesï¼ˆèŠ‚ç‚¹ï¼‰** = å·¥å‚é‡Œçš„å·¥äºº ğŸ‘·
- æ¥æ”¶ Stateï¼ˆåŒ…è£¹ï¼‰
- åšä¸€äº›å·¥ä½œï¼ˆå¤„ç†æ•°æ®ã€è°ƒç”¨ LLM ç­‰ï¼‰
- è¿”å›æ›´æ–°åçš„ State

**Edgesï¼ˆè¾¹ï¼‰** = ä¼ é€å¸¦çš„è·¯å¾„ ğŸ›¤ï¸
- **æ™®é€šè¾¹**ï¼šå›ºå®šè·¯çº¿ï¼ˆA â†’ Bï¼‰
- **æ¡ä»¶è¾¹**ï¼šæ ¹æ®çŠ¶æ€åŠ¨æ€é€‰æ‹©ï¼ˆA â†’ B æˆ– Cï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# æ™®é€šè¾¹
graph.add_edge("node_a", "node_b")

# æ¡ä»¶è¾¹
def route_func(state):
    return "node_x" if condition else END

graph.add_conditional_edges("node_a", route_func)
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜3ï¼š`tool_call_id` çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

**ä½œç”¨**ï¼šåŒ¹é…å·¥å…·è°ƒç”¨å’Œç»“æœ

**ä¸ºä»€ä¹ˆéœ€è¦**ï¼š
- ä¸€æ¬¡å¯èƒ½è°ƒç”¨å¤šä¸ªå·¥å…·
- éœ€è¦çŸ¥é“å“ªä¸ªç»“æœå¯¹åº”å“ªä¸ªè°ƒç”¨

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# LLM è°ƒç”¨å·¥å…·
AIMessage(
    tool_calls=[
        {"id": "call_001", "name": "multiply", "args": {"a": 3, "b": 5}},
        {"id": "call_002", "name": "add", "args": {"a": 10, "b": 20}}
    ]
)

# å·¥å…·è¿”å›ç»“æœï¼ˆé€šè¿‡ tool_call_id åŒ¹é…ï¼‰
ToolMessage(content=15, tool_call_id="call_001")  # å¯¹åº” multiply
ToolMessage(content=30, tool_call_id="call_002")  # å¯¹åº” add
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜4ï¼šToolNode è‡ªåŠ¨åšä»€ä¹ˆï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

ToolNode æ˜¯ä¸€ä¸ª**é¢„å®šä¹‰çš„èŠ‚ç‚¹**ï¼Œè‡ªåŠ¨ï¼š

1. æ¥æ”¶ State
2. æ£€æŸ¥æœ€åä¸€æ¡ AIMessage çš„ `tool_calls`
3. è°ƒç”¨å¯¹åº”çš„å·¥å…·
4. å°†ç»“æœåŒ…è£…æˆ ToolMessage
5. è¿”å›æ›´æ–°çš„ State

**ä»£ç ç¤ºä¾‹**ï¼š
```python
from langgraph.prebuilt import ToolNode

# å®šä¹‰å·¥å…·
@tool
def multiply(a: int, b: int) -> int:
    return a * b

# åˆ›å»º ToolNode
tool_node = ToolNode([multiply])

# æ·»åŠ åˆ°å›¾ä¸­
graph.add_node("tools", tool_node)
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜5ï¼šä¸‰ç§æ¶ˆæ¯ç±»å‹çš„åŒºåˆ«ï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

1. **HumanMessageï¼ˆç”¨æˆ·æ¶ˆæ¯ï¼‰**
   ```python
   HumanMessage(content="3 ä¹˜ä»¥ 5 ç­‰äºå¤šå°‘ï¼Ÿ")
   ```

2. **AIMessageï¼ˆAIå›å¤ï¼‰**
   ```python
   # æ™®é€šå›å¤
   AIMessage(content="ç­”æ¡ˆæ˜¯ 15")

   # å¸¦å·¥å…·è°ƒç”¨
   AIMessage(
       content="",
       tool_calls=[{
           "name": "multiply",
           "args": {"a": 3, "b": 5},
           "id": "call_001"
       }]
   )
   ```

3. **ToolMessageï¼ˆå·¥å…·ç»“æœï¼‰**
   ```python
   ToolMessage(
       content=15,
       tool_call_id="call_001"  # â† å¿…é¡»åŒ¹é… AIMessage çš„ id
   )
   ```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå·¥å…·è°ƒç”¨æµç¨‹ï¼ˆ2é¢˜ï¼‰

### é—®é¢˜6ï¼šå®Œæ•´çš„å·¥å…·è°ƒç”¨æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

```
ç”¨æˆ·è¾“å…¥ "3ä¹˜ä»¥5"
    â†“
1. HumanMessage(content="3ä¹˜ä»¥5")
    â†“
2. LLM èŠ‚ç‚¹ï¼ˆllm_with_tools.invokeï¼‰
    â†“
3. AIMessage(tool_calls=[{name: "multiply", args: {a:3, b:5}}])
    â†“
4. should_continue æ£€æµ‹åˆ° tool_calls â†’ è¿”å› "tools"
    â†“
5. ToolNode æ‰§è¡Œ multiply(3, 5) â†’ 15
    â†“
6. ToolMessage(content=15, tool_call_id="...")
    â†“
7. å›åˆ° LLM èŠ‚ç‚¹ï¼ˆtools â†’ llm è¾¹ï¼‰
    â†“
8. AIMessage(content="3ä¹˜ä»¥5ç­‰äº15")
    â†“
9. should_continue æ²¡æœ‰æ£€æµ‹åˆ° tool_calls â†’ è¿”å› END
    â†“
10. ç»“æŸ
```

**å…³é”®ç‚¹**ï¼š
- LLM èŠ‚ç‚¹å¯èƒ½è¿”å› tool_calls
- æ¡ä»¶å‡½æ•°åˆ¤æ–­æ˜¯å¦å»å·¥å…·èŠ‚ç‚¹
- å·¥å…·æ‰§è¡Œå®Œå¿…é¡»å›åˆ° LLMï¼ˆè®© LLM çœ‹åˆ°ç»“æœï¼‰

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜7ï¼š`bind_tools()` çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

**ä½œç”¨**ï¼šæŠŠå·¥å…·æ¸…å•"ç»‘"åˆ° LLM ä¸Šï¼Œè®© LLM çŸ¥é“æœ‰å“ªäº›å·¥å…·å¯ç”¨

```python
# åˆ›å»º LLM
llm = ChatOpenAI(model="glm-4-flash", ...)

# ç»‘å®šå·¥å…·
llm_with_tools = llm.bind_tools([multiply, add, divide])

# ç°åœ¨ LLM çŸ¥é“æœ‰è¿™äº›å·¥å…·äº†
response = llm_with_tools.invoke("3ä¹˜ä»¥5")
# LLM å¯èƒ½è¿”å› tool_calls=[{name: "multiply", ...}]
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šç±»å‹æ³¨è§£å’Œæºç é˜…è¯»ï¼ˆ3é¢˜ï¼‰

### é—®é¢˜8ï¼š`*` ç¬¦å·åœ¨å‡½æ•°ç­¾åä¸­çš„å«ä¹‰ï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

**å«ä¹‰**ï¼š`*` åé¢çš„å‚æ•°å¿…é¡»ç”¨å…³é”®å­—ä¼ é€’

**ç¤ºä¾‹**ï¼š
```python
def invoke(
    self,
    input: dict[str, Any],
    *,                    # â† å…³é”®ï¼
    context: str = None   # â† å¿…é¡»ç”¨å…³é”®å­—
):
```

**ä½¿ç”¨**ï¼š
```python
# âœ… æ­£ç¡®
app.invoke({"messages": [...]})
app.invoke({"messages": [...]}, context="...")

# âŒ é”™è¯¯
app.invoke(context="...")  # ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯ input
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜9ï¼š`|` ç¬¦å·åœ¨ç±»å‹æ³¨è§£ä¸­çš„å«ä¹‰ï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

**å«ä¹‰**ï¼š"æˆ–"çš„æ„æ€ï¼ˆPython 3.10+ï¼‰

```python
x: str | int  # x å¯ä»¥æ˜¯ str æˆ– int

# ç­‰ä»·äºæ—§å†™æ³•
from typing import Union
x: Union[str, int]
```

**å¸¸è§ç”¨æ³•**ï¼š
```python
x: str | None      # str æˆ– None
x: dict | list     # dict æˆ– list
```

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

### é—®é¢˜10ï¼šå¦‚ä½•æ£€æŸ¥å¯¹è±¡æ˜¯å¦æœ‰æŸä¸ªå±æ€§ï¼Ÿ

**ä½ çš„ç­”æ¡ˆ**ï¼š





---

**æ­£ç¡®ç­”æ¡ˆ** ğŸ‘†

**æ–¹æ³•**ï¼šä½¿ç”¨ `hasattr()` å‡½æ•°

```python
if hasattr(last_message, "tool_calls") and last_message.tool_calls:
    return "tools"
```

**ä¸ºä»€ä¹ˆéœ€è¦ hasattrï¼Ÿ**
- ä¸æ˜¯æ‰€æœ‰æ¶ˆæ¯ç±»å‹éƒ½æœ‰ `tool_calls` å­—æ®µ
- HumanMessage æ²¡æœ‰ï¼ŒAIMessage å¯èƒ½æœ‰
- `hasattr()` å®‰å…¨åœ°æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨

**ä½ çš„æŒæ¡æƒ…å†µ**ï¼š
- [ ] âœ… å®Œå…¨æŒæ¡
- [ ] âš ï¸ æœ‰ç‚¹æ¨¡ç³Š
- [ ] âŒ å®Œå…¨å¿˜è®°

---

## ğŸ“Š å¤ä¹ ç»“æœç»Ÿè®¡

### ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¦‚å¿µ
- é—®é¢˜1ï¼ˆStateï¼‰ï¼š
- é—®é¢˜2ï¼ˆNodes/Edgesï¼‰ï¼š
- é—®é¢˜3ï¼ˆtool_call_idï¼‰ï¼š
- é—®é¢˜4ï¼ˆToolNodeï¼‰ï¼š
- é—®é¢˜5ï¼ˆæ¶ˆæ¯ç±»å‹ï¼‰ï¼š

### ç¬¬äºŒéƒ¨åˆ†ï¼šå·¥å…·è°ƒç”¨æµç¨‹
- é—®é¢˜6ï¼ˆè°ƒç”¨æµç¨‹ï¼‰ï¼š
- é—®é¢˜7ï¼ˆbind_toolsï¼‰ï¼š

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šç±»å‹æ³¨è§£
- é—®é¢˜8ï¼ˆ`*` ç¬¦å·ï¼‰ï¼š
- é—®é¢˜9ï¼ˆ`|` ç¬¦å·ï¼‰ï¼š
- é—®é¢˜10ï¼ˆhasattrï¼‰ï¼š

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

**å¦‚æœå…¨éƒ¨ âœ…**ï¼š
- æ­å–œï¼ç¬¬ä¸€é˜¶æ®µçŸ¥è¯†æŒæ¡ç‰¢å›ºï¼
- å¯ä»¥è¿›å…¥ç¬¬äºŒé˜¶æ®µå­¦ä¹ äº†

**å¦‚æœæœ‰ âš ï¸ æˆ– âŒ**ï¼š
- é‡ç‚¹å¤ä¹ è¿™äº›é¢˜ç›®
- æŸ¥çœ‹å¯¹åº”è®²ä¹‰ç« èŠ‚
- é‡æ–°è¿è¡Œç›¸å…³ç»ƒä¹ 

**è®²ä¹‰å¯¹åº”**ï¼š
- é—®é¢˜1-5 â†’ [01_core_concepts.md](../../docs/phase01_basics/01_core_concepts.md)
- é—®é¢˜6-7 â†’ [03_tools_and_llm.md](../../docs/phase01_basics/03_tools_and_llm.md)
- é—®é¢˜8-10 â†’ [04_reading_source_code.md](../../docs/phase01_basics/04_reading_source_code.md)
